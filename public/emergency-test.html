<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æ”¶è—åŠŸèƒ½ç´§æ€¥æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px;
    }
    button:hover {
      background: #1d4ed8;
    }
    .danger {
      background: #dc2626;
    }
    .danger:hover {
      background: #b91c1c;
    }
    .output {
      background: #f3f4f6;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      font-family: monospace;
      font-size: 14px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>ğŸš¨ æ”¶è—åŠŸèƒ½ç´§æ€¥æµ‹è¯•</h1>
  
  <div>
    <h2>æµ‹è¯• 1: æŸ¥çœ‹ localStorage</h2>
    <button onclick="viewStorage()">æŸ¥çœ‹å½“å‰æ”¶è—</button>
    <div id="storage-output" class="output"></div>
  </div>

  <div>
    <h2>æµ‹è¯• 2: æ‰‹åŠ¨åˆ é™¤ videoId=201</h2>
    <button onclick="manualDelete()" class="danger">åˆ é™¤ videoId 201</button>
    <div id="delete-output" class="output"></div>
  </div>

  <div>
    <h2>æµ‹è¯• 3: æ£€æŸ¥ Hook å‡½æ•°</h2>
    <button onclick="checkHook()">æ£€æŸ¥ useBookmarks</button>
    <div id="hook-output" class="output"></div>
  </div>

  <script>
    function viewStorage() {
      const output = document.getElementById('storage-output');
      const data = localStorage.getItem('user_assets');
      
      if (!data) {
        output.textContent = 'âŒ localStorage ä¸­æ²¡æœ‰æ•°æ®';
        return;
      }
      
      try {
        const bookmarks = JSON.parse(data);
        output.textContent = `âœ… æ‰¾åˆ° ${bookmarks.length} ä¸ªæ”¶è—:\n\n`;
        
        bookmarks.forEach((b, i) => {
          output.textContent += `${i + 1}. ${b.title}\n`;
          output.textContent += `   id: ${b.id} (${typeof b.id})\n`;
          output.textContent += `   videoId: ${b.videoId} (${typeof b.videoId})\n`;
          output.textContent += `   folder: ${b.folder}\n\n`;
        });
        
        // æ£€æŸ¥æ˜¯å¦æœ‰ videoId 201
        const has201 = bookmarks.some(b => String(b.videoId) === '201');
        output.textContent += `\nğŸ“Œ æ˜¯å¦æœ‰ videoId=201: ${has201 ? 'æ˜¯' : 'å¦'}`;
        
      } catch (error) {
        output.textContent = 'âŒ è§£æå¤±è´¥: ' + error.message;
      }
    }

    function manualDelete() {
      const output = document.getElementById('delete-output');
      
      try {
        const data = localStorage.getItem('user_assets');
        if (!data) {
          output.textContent = 'âŒ æ²¡æœ‰æ•°æ®å¯åˆ é™¤';
          return;
        }
        
        const bookmarks = JSON.parse(data);
        output.textContent = `åˆ é™¤å‰: ${bookmarks.length} ä¸ªæ”¶è—\n\n`;
        
        // æŸ¥æ‰¾ videoId 201
        const target = bookmarks.find(b => String(b.videoId) === '201');
        if (target) {
          output.textContent += `æ‰¾åˆ°ç›®æ ‡:\n`;
          output.textContent += `  title: ${target.title}\n`;
          output.textContent += `  id: ${target.id}\n`;
          output.textContent += `  videoId: ${target.videoId}\n\n`;
        } else {
          output.textContent += 'âŒ æ²¡æœ‰æ‰¾åˆ° videoId=201 çš„æ”¶è—\n';
          return;
        }
        
        // åˆ é™¤
        const updated = bookmarks.filter(b => String(b.videoId) !== '201');
        localStorage.setItem('user_assets', JSON.stringify(updated));
        window.dispatchEvent(new Event('storage'));
        
        output.textContent += `âœ… åˆ é™¤æˆåŠŸ!\n`;
        output.textContent += `åˆ é™¤å: ${updated.length} ä¸ªæ”¶è—\n`;
        output.textContent += `å·²è§¦å‘ storage äº‹ä»¶\n\n`;
        output.textContent += `è¯·åˆ·æ–°ä¸»é¡µé¢æŸ¥çœ‹æ•ˆæœ`;
        
      } catch (error) {
        output.textContent = 'âŒ åˆ é™¤å¤±è´¥: ' + error.message;
      }
    }

    function checkHook() {
      const output = document.getElementById('hook-output');
      output.textContent = 'âš ï¸ æ­¤æµ‹è¯•éœ€è¦åœ¨ä¸»åº”ç”¨é¡µé¢çš„æ§åˆ¶å°è¿è¡Œ\n\n';
      output.textContent += 'è¯·åœ¨è§†é¢‘è¯¦æƒ…é¡µæ‰“å¼€æ§åˆ¶å°,è¿è¡Œ:\n\n';
      output.textContent += 'const data = JSON.parse(localStorage.getItem("user_assets"));\n';
      output.textContent += 'console.log("æ”¶è—æ•°é‡:", data.length);\n';
      output.textContent += 'console.log("æ˜¯å¦æœ‰201:", data.some(b => String(b.videoId) === "201"));\n';
    }

    // è‡ªåŠ¨æ˜¾ç¤º
    viewStorage();
  </script>
</body>
</html>
