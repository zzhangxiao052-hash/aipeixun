<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ğŸš¨ ç»ˆææµ‹è¯• - ç›´æ¥åˆ é™¤</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #dc2626;
      margin-bottom: 30px;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
      font-weight: bold;
    }
    button:hover {
      background: #1d4ed8;
    }
    .danger {
      background: #dc2626;
    }
    .danger:hover {
      background: #b91c1c;
    }
    .success {
      background: #16a34a;
    }
    .success:hover {
      background: #15803d;
    }
    .output {
      background: #1e293b;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .highlight {
      color: #fbbf24;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš¨ ç»ˆææµ‹è¯• - ç›´æ¥æ“ä½œ localStorage</h1>
    
    <div style="margin-bottom: 30px;">
      <h2>æ­¥éª¤ 1: æŸ¥çœ‹å½“å‰æ•°æ®</h2>
      <button onclick="viewData()">ğŸ“Š æŸ¥çœ‹æ‰€æœ‰æ”¶è—</button>
    </div>

    <div style="margin-bottom: 30px;">
      <h2>æ­¥éª¤ 2: åˆ é™¤ videoId=201</h2>
      <button onclick="deleteVideo201()" class="danger">ğŸ—‘ï¸ åˆ é™¤ videoId 201</button>
    </div>

    <div style="margin-bottom: 30px;">
      <h2>æ­¥éª¤ 3: æ¸…ç†æ‰€æœ‰é‡å¤æ•°æ®</h2>
      <button onclick="cleanupDuplicates()" class="success">ğŸ§¹ æ¸…ç†é‡å¤é¡¹</button>
    </div>

    <div style="margin-bottom: 30px;">
      <h2>æ­¥éª¤ 4: å®Œå…¨é‡ç½®</h2>
      <button onclick="resetAll()" class="danger">ğŸ’£ æ¸…ç©ºæ‰€æœ‰æ”¶è—</button>
    </div>

    <div id="output" class="output">ç­‰å¾…æ“ä½œ...</div>
  </div>

  <script>
    const output = document.getElementById('output');

    function log(message, isHighlight = false) {
      const line = document.createElement('div');
      if (isHighlight) {
        line.className = 'highlight';
      }
      line.textContent = message;
      output.appendChild(line);
      output.scrollTop = output.scrollHeight;
    }

    function clearOutput() {
      output.innerHTML = '';
    }

    function viewData() {
      clearOutput();
      log('='.repeat(50), true);
      log('ğŸ“Š æŸ¥çœ‹å½“å‰æ”¶è—æ•°æ®', true);
      log('='.repeat(50), true);
      
      try {
        const data = localStorage.getItem('user_assets');
        
        if (!data) {
          log('\nâŒ localStorage ä¸­æ²¡æœ‰æ•°æ®');
          return;
        }
        
        const bookmarks = JSON.parse(data);
        log(`\nâœ… æ‰¾åˆ° ${bookmarks.length} ä¸ªæ”¶è—\n`);
        
        bookmarks.forEach((b, i) => {
          log(`${i + 1}. ${b.title}`);
          log(`   id: ${b.id} (${typeof b.id})`);
          log(`   videoId: ${b.videoId} (${typeof b.videoId})`);
          log(`   folder: ${b.folder || 'é»˜è®¤'}`);
          log('');
        });
        
        // ç»Ÿè®¡ videoId=201 çš„æ•°é‡
        const count201 = bookmarks.filter(b => String(b.videoId) === '201').length;
        log(`\nğŸ“Œ videoId=201 çš„æ”¶è—æ•°é‡: ${count201}`, true);
        
      } catch (error) {
        log(`\nâŒ é”™è¯¯: ${error.message}`);
      }
    }

    function deleteVideo201() {
      clearOutput();
      log('='.repeat(50), true);
      log('ğŸ—‘ï¸ åˆ é™¤ videoId=201', true);
      log('='.repeat(50), true);
      
      try {
        const data = localStorage.getItem('user_assets');
        
        if (!data) {
          log('\nâŒ æ²¡æœ‰æ•°æ®å¯åˆ é™¤');
          return;
        }
        
        const bookmarks = JSON.parse(data);
        log(`\nåˆ é™¤å‰: ${bookmarks.length} ä¸ªæ”¶è—`);
        
        // æŸ¥æ‰¾æ‰€æœ‰ videoId=201 çš„æ”¶è—
        const targets = bookmarks.filter(b => String(b.videoId) === '201');
        log(`æ‰¾åˆ° ${targets.length} ä¸ª videoId=201 çš„æ”¶è—:`);
        targets.forEach(t => {
          log(`  - id: ${t.id}, title: ${t.title}`);
        });
        
        // åˆ é™¤
        const updated = bookmarks.filter(b => String(b.videoId) !== '201');
        log(`\nåˆ é™¤å: ${updated.length} ä¸ªæ”¶è—`);
        log(`åˆ é™¤äº† ${bookmarks.length - updated.length} ä¸ªæ”¶è—`, true);
        
        // ä¿å­˜
        localStorage.setItem('user_assets', JSON.stringify(updated));
        log('\nâœ… å·²ä¿å­˜åˆ° localStorage', true);
        
        // éªŒè¯
        const verify = JSON.parse(localStorage.getItem('user_assets'));
        const stillHas201 = verify.some(b => String(b.videoId) === '201');
        log(`\néªŒè¯: æ˜¯å¦è¿˜æœ‰ videoId=201? ${stillHas201 ? 'æ˜¯ âŒ' : 'å¦ âœ…'}`, true);
        
        if (!stillHas201) {
          log('\nğŸ‰ åˆ é™¤æˆåŠŸ!è¯·åˆ·æ–°ä¸»é¡µé¢æŸ¥çœ‹æ•ˆæœ', true);
        }
        
      } catch (error) {
        log(`\nâŒ é”™è¯¯: ${error.message}`);
      }
    }

    function cleanupDuplicates() {
      clearOutput();
      log('='.repeat(50), true);
      log('ğŸ§¹ æ¸…ç†é‡å¤æ•°æ®', true);
      log('='.repeat(50), true);
      
      try {
        const data = localStorage.getItem('user_assets');
        
        if (!data) {
          log('\nâŒ æ²¡æœ‰æ•°æ®');
          return;
        }
        
        const bookmarks = JSON.parse(data);
        log(`\næ¸…ç†å‰: ${bookmarks.length} ä¸ªæ”¶è—`);
        
        // æŒ‰ videoId å»é‡
        const uniqueMap = new Map();
        bookmarks.forEach(b => {
          const id = String(b.videoId);
          if (!uniqueMap.has(id)) {
            uniqueMap.set(id, b);
          }
        });
        
        const unique = Array.from(uniqueMap.values());
        log(`æ¸…ç†å: ${unique.length} ä¸ªæ”¶è—`);
        log(`åˆ é™¤äº† ${bookmarks.length - unique.length} ä¸ªé‡å¤é¡¹`, true);
        
        // ä¿å­˜
        localStorage.setItem('user_assets', JSON.stringify(unique));
        log('\nâœ… å·²ä¿å­˜åˆ° localStorage', true);
        log('\nğŸ‰ æ¸…ç†å®Œæˆ!è¯·åˆ·æ–°ä¸»é¡µé¢æŸ¥çœ‹æ•ˆæœ', true);
        
      } catch (error) {
        log(`\nâŒ é”™è¯¯: ${error.message}`);
      }
    }

    function resetAll() {
      if (!confirm('âš ï¸ ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ”¶è—å—?è¿™ä¸ªæ“ä½œä¸å¯æ¢å¤!')) {
        return;
      }
      
      clearOutput();
      log('='.repeat(50), true);
      log('ğŸ’£ æ¸…ç©ºæ‰€æœ‰æ”¶è—', true);
      log('='.repeat(50), true);
      
      try {
        const data = localStorage.getItem('user_assets');
        const count = data ? JSON.parse(data).length : 0;
        
        localStorage.setItem('user_assets', '[]');
        log(`\nâœ… å·²åˆ é™¤ ${count} ä¸ªæ”¶è—`, true);
        log('\nğŸ‰ localStorage å·²é‡ç½®!', true);
        
      } catch (error) {
        log(`\nâŒ é”™è¯¯: ${error.message}`);
      }
    }

    // è‡ªåŠ¨æ˜¾ç¤ºæ•°æ®
    viewData();
  </script>
</body>
</html>
